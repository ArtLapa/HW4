import json
from datetime import datetime

def save_message_to_json(username, message):
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S.%f")
    message_dict = {'username': username, 'message': message}
    with open('storage/data.json', 'a+', encoding='utf-8') as file:
        try:
            file.seek(0)
            data = json.load(file)
        except json.JSONDecodeError:
            data = []

        data.append({timestamp: message_dict})

        file.seek(0)
        json.dump(data, file, ensure_ascii=False, indent=2)
        file.truncate()

# ...

class MyHandler(http.server.SimpleHTTPRequestHandler):
    # ...

    def do_POST(self):
        content_length = int(self.headers['Content-Length'])
        post_data = self.rfile.read(content_length)
        post_params = parse_qs(post_data.decode())

        save_message_to_json(post_params['username'][0], post_params['message'][0])

        self.send_response(302)
        self.send_header('Location', '/')
        self.end_headers()
